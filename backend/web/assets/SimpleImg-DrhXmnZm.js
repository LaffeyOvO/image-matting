import{q as Ae,x as Be,r as u,y as r,o as te,z as Ee,A as J,g as s,a as h,c as w,B as d,b as i,t as D,C as ve,D as Pe,u as Me,E as De,G as He,f as We,m as de,p as Oe,d as Te}from"./index-D1CJl6Y2.js";import{a as ce}from"./ai_matting-DPxnUe2y.js";import{m as M}from"./message-B7YrNn6S.js";import{_ as ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ne=["innerHTML"],Ve=["id"],Fe=["alt","src"],Xe=["alt","src"],Ye=["innerHTML"],je=Ae({__name:"VueCompareImage",props:{aspectRatio:{default:"wider"},handle:{type:[String,Number,Boolean]},handleSize:{default:40},hover:{type:Boolean,default:!1},slideOnClick:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!1},keyboardStep:{default:.01},leftImage:{},leftImageAlt:{},leftImageCss:{},leftImageLabel:{},onSliderPositionChange:{type:Function,default:()=>{}},rightImage:{},rightImageAlt:{},rightImageCss:{},rightImageLabel:{},skeleton:{type:[String,Number,Boolean]},sliderLineColor:{default:"#ffffff"},sliderLineWidth:{default:2},sliderPositionPercentage:{default:.5},vertical:{type:Boolean,default:!1}},emits:["slideStart","slideEnd","isSliding"],setup(C,{emit:g}){const y=C,L=g,{aspectRatio:x,leftImage:H,leftImageAlt:W,leftImageLabel:I,leftImageCss:U,rightImage:Q,rightImageAlt:Z,rightImageLabel:O,rightImageCss:ee,hover:T,handle:q,handleSize:a,sliderLineWidth:o,sliderPositionPercentage:k,skeleton:z,sliderLineColor:$,vertical:R,onSliderPositionChange:A,slideOnClick:G,keyboard:N,keyboardStep:c}=Be(y),fe=Math.random().toString(36).substr(2,9),l=!R.value,b=u(),B=u(null),V=u(null),n=u(k.value),f=u(0),p=u(0),F=u(!1),X=u(!1),E=u(!1),ae=r(()=>F.value&&X.value),K=r(()=>n.value),le=r(()=>1-n.value),ne=r(()=>({display:ae.value?"flex":"none",height:`${p.value}px`})),ge=r(()=>({clipPath:l?`inset(0px 0px 0px ${f.value*K.value}px)`:`inset(${p.value*K.value}px 0px 0px 0px)`,...ee})),pe=r(()=>({clipPath:l?`inset(0px ${f.value*le.value}px 0px 0px)`:`inset(0px 0px ${p.value*le.value}px 0px)`,...U})),me=r(()=>({cursor:!T.value&&l?"ew-resize !important":!T.value&&!l?"ns-resize !important":void 0,flexDirection:l?"column":"row",height:l?"100%":`${a.value}px`,left:l?`${f.value*n.value-a.value/2}px`:"0",top:l?"0":`${p.value*n.value-a.value/2}px`,width:l?`${a.value}px`:"100%"})),oe=r(()=>({background:$.value,height:l?"100%":`${o.value}px`,width:l?`${o.value}px`:"100%"})),he=r(()=>({border:`${o.value}px solid ${$.value}`,height:`${a.value}px`,width:`${a.value}px`,transform:l?"none":"rotate(90deg)"})),we=r(()=>({border:`inset ${a.value*.15}px rgba(0,0,0,0)`,borderRight:`${a.value*.15}px solid ${$.value}`,marginLeft:`-${a.value*.25}px`,marginRight:`${a.value*.25}px`})),ye=r(()=>({border:`inset ${a.value*.15}px rgba(0,0,0,0)`,borderLeft:`${a.value*.15}px solid ${$.value}`,marginRight:`-${a.value*.25}px`})),xe=r(()=>({left:l?"5%":"50%",opacity:E.value?0:1,top:l?"50%":"3%",transform:l?"translate(0,-50%)":"translate(-50%, 0)"})),be=r(()=>({opacity:E.value?0:1,left:l?"unset":"50%",right:l?"5%":"unset",top:l?"50%":"unset",bottom:l?"unset":"3%",transform:l?"translate(0,-50%)":"translate(-50%, 0)"})),_e=r(()=>({clip:l?`rect(auto, ${f.value*n.value}px, auto, auto)`:`rect(auto, auto, ${p.value*n.value}px, auto)`})),Le=r(()=>({clipPath:l?`inset(0px 0px 0px ${f.value*K.value}px)`:`inset(${p.value*K.value}px 0px 0px 0px)`}));function S(e){const t=e,m=t.touches?t.touches[0].pageX:t.pageX,j=t.touches?t.touches[0].pageY:t.pageY,Ce=m-window.pageXOffset,Re=j-window.pageYOffset,ie=B.value.getBoundingClientRect();let _=l?Ce-ie.left:Re-ie.top;const re=0+o.value/2,ue=l?f.value-o.value/2:p.value-o.value/2;_<re&&(_=re),_>ue&&(_=ue),n.value=l?_/f.value:_/p.value,A.value&&A.value(l?_/f.value:_/p.value)}function P(e){E.value=!0,L("slideStart",n.value),L("isSliding",E.value),l&&"touches"in e||e.preventDefault(),G.value&&S(e),window.addEventListener("mousemove",S),window.addEventListener("touchmove",S),window.addEventListener("mouseup",v),window.addEventListener("touchend",v)}function v(){E.value=!1,L("slideEnd",n.value),L("isSliding",E.value),window.removeEventListener("mousemove",S),window.removeEventListener("touchmove",S),window.removeEventListener("mouseup",v),window.removeEventListener("touchend",v)}function Ie(){N.value&&window.addEventListener("keydown",Y)}function ke(){N.value&&window.removeEventListener("keydown",Y)}function $e(){N.value&&window.addEventListener("keydown",Y)}function se(e){b.value&&!b.value.contains(e.target)&&(b.value.blur(),window.removeEventListener("keydown",Y))}function Y(e){e.key==="ArrowDown"&&!l?(e.preventDefault(),n.value+c.value>1?n.value=1:n.value+=c.value):e.key==="ArrowUp"&&!l||e.key==="ArrowLeft"&&l?(e.preventDefault(),n.value-c.value<0?n.value=0:n.value-=c.value):e.key==="ArrowRight"&&l&&(e.preventDefault(),n.value+c.value>1?n.value=1:n.value+=c.value)}function Se(){var m;const e=Pe();(m=e==null?void 0:e.proxy)==null||m.$forceUpdate();const t=b.value;y.hover?(t==null||t.addEventListener("mousemove",P),t==null||t.addEventListener("mouseleave",v)):(t==null||t.removeEventListener("mousemove",P),t==null||t.removeEventListener("mouseleave",v),t==null||t.addEventListener("mouseup",v),t==null||t.addEventListener("touchend",v))}return te(()=>{const e=b.value,t=new ResizeObserver(([m])=>{const j=m.target.getBoundingClientRect().width;f.value=j});return t.observe(e),()=>t.disconnect()}),te(()=>{const e=b.value;y.hover&&(e==null||e.addEventListener("mousemove",P),e==null||e.addEventListener("mouseleave",v)),window.addEventListener("click",se)}),Ee(()=>{const e=b.value;e==null||e.removeEventListener("mousemove",P),e==null||e.removeEventListener("mouseleave",v),window.removeEventListener("keydown",Y),window.removeEventListener("click",se),window.removeEventListener("mousemove",S),window.removeEventListener("touchmove",S),window.removeEventListener("mouseup",v),window.removeEventListener("touchend",v)}),J(V,()=>{var e;F.value=!1,(e=V.value)!=null&&e.complete&&(F.value=!0)}),J(B,()=>{var e;X.value=!1,(e=B.value)!=null&&e.complete&&(X.value=!0)}),J(T,()=>{Se()}),J([()=>f.value,()=>F.value,()=>X.value],()=>{const e=V.value.naturalHeight/V.value.naturalWidth,t=B.value.naturalHeight/B.value.naturalWidth,m=x.value==="taller"?Math.max(e,t):Math.min(e,t),j=f.value*m;p.value=j}),(e,t)=>s(z)&&!ae.value?(h(),w("div",{key:0,"data-testid":"skeleton",style:d(ne.value),innerHTML:s(z)},null,12,Ne)):(h(),w("div",{key:1,id:s(fe),ref_key:"containerRef",ref:b,class:"vci--container",tabindex:"0","data-testid":"vci-container",style:d(ne.value),onClick:$e,onTouchstart:P,onTouchend:v,onFocusin:Ie,onFocusout:ke,onMousedown:P,onMouseup:v},[i("img",{ref_key:"rightImageRef",ref:B,class:"vci--right-image",alt:s(Z),"data-testid":"right-image",src:s(Q),style:d(ge.value),onLoad:t[0]||(t[0]=m=>X.value=!0)},null,44,Fe),i("img",{ref_key:"leftImageRef",ref:V,class:"vci--left-image",alt:s(W),"data-testid":"left-image",src:s(H),style:d(pe.value),onLoad:t[1]||(t[1]=m=>F.value=!0)},null,44,Xe),i("div",{class:"vci--slider",style:d(me.value)},[i("div",{class:"vci--slider-line",style:d(oe.value)},null,4),s(q)?(h(),w("div",{key:0,class:"vci--custom-handle",innerHTML:s(q)},null,8,Ye)):(h(),w("div",{key:1,class:"vci--default-handle",style:d(he.value)},[i("div",{class:"vci--left-arrow",style:d(we.value)},null,4),i("div",{class:"vci--right-arrow",style:d(ye.value)},null,4)],4)),i("div",{class:"vci--slider-line",style:d(oe.value)},null,4)],4),s(I)?(h(),w("div",{key:0,class:"vci--left-label-container",style:d(_e.value)},[i("div",{class:"vci--left-label","data-testid":"left-image-label",style:d(xe.value)},D(s(I)),5)],4)):ve("",!0),s(O)?(h(),w("div",{key:1,class:"vci--right-label-container",style:d(Le.value)},[i("div",{class:"vci--right-label","data-testid":"right-image-label",style:d(be.value)},D(s(O)),5)],4)):ve("",!0)],44,Ve))}}),Ue=C=>(Oe("data-v-a9691672"),C=C(),Te(),C),qe={class:"relative overflow-x-auto mx-auto h-full flex flex-col items-center justify-center"},Ge={key:0,class:"w-full max-w-3xl p-4"},Ke={class:"flex items-center justify-center h-full"},Je={class:"flex justify-center space-x-4 mt-4"},Qe={key:1,class:"flex justify-center items-center h-full"},Ze=Ue(()=>i("div",{class:"loader"},null,-1)),et=[Ze],tt={__name:"SimpleImg",setup(C){const{t:g}=Me(),y=u(!0),L=De(),x=u("");x.value=L.params.filePath;const H=u("");H.value=L.params.imgType;const W=u(""),I=u("");async function U(){if(H.value==="local"){const a=await ce("get_local_file_base64",x.value);console.log(a),a.code===200?W.value=a.data.base64_image:M.error(a.error_msg)}else W.value=x.value}u({});const Q=()=>{window.history.back()},Z=async()=>{const a=await de("open_file_dialog","");y.value=!0,H.value="local",a.data.file_path&&(x.value=a.data.file_path,console.log(x.value),await U(),await O()),y.value=!1};async function O(){const a=await ce("predict",x.value);a.code===200?I.value=a.data.no_bg_image:M.error(a.error_msg),y.value=!1}function ee(a){const o=a.split(";base64,"),k=o[0].split(":")[1],z=atob(o[1]),$=[];for(let R=0;R<z.length;R+=1024){const A=z.slice(R,R+1024),G=new Array(A.length);for(let c=0;c<A.length;c++)G[c]=A.charCodeAt(c);const N=new Uint8Array(G);$.push(N)}return new Blob($,{type:k})}async function T(){try{const a=ee(I.value),o=new ClipboardItem({"image/png":a});await navigator.clipboard.write([o]),M.info(g("ai_matting.copy_success"))}catch(a){M.error(g("ai_matting.copy_error"),a)}}async function q(){(await de("save_png_dialog",I.value)).code===200?M.info(g("ai_matting.download_success")):M.error(g("ai_matting.download_error"))}return He(async()=>{await U()}),te(async()=>{await O()}),(a,o)=>(h(),w("div",qe,[y.value?(h(),w("div",Qe,et)):(h(),w("div",Ge,[i("div",Ke,[We(s(je),{"left-image":W.value,"right-image":I.value,class:"img-container img-transparent-bg"},null,8,["left-image","right-image"])]),i("div",Je,[i("button",{onClick:o[0]||(o[0]=k=>Q()),class:"bg-green-500 text-white px-4 py-2 rounded-full"},D(s(g)("ai_matting.btn_back")),1),i("button",{onClick:o[1]||(o[1]=k=>Z()),class:"bg-green-500 text-white px-4 py-2 rounded-full"},D(s(g)("ai_matting.btn_reselect")),1),i("button",{onClick:o[2]||(o[2]=k=>T()),class:"bg-green-500 text-white px-4 py-2 rounded-full"},D(s(g)("ai_matting.btn_copy")),1),i("button",{onClick:o[3]||(o[3]=k=>q()),class:"bg-green-500 text-white px-4 py-2 rounded-full"},D(s(g)("ai_matting.btn_download")),1)])]))]))}},st=ze(tt,[["__scopeId","data-v-a9691672"]]);export{st as default};
