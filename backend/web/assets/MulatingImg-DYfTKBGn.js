import{u as P,E as j,r as c,y as $,o as F,k as A,a as l,c as n,b as t,t as i,g,F as z,l as D,C as v,m as w}from"./index-ud1mkppS.js";import{a as k}from"./ai_matting-CaU7UFEr.js";import{m as x}from"./message-CcOXwnpb.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const E={class:"flex justify-center w-full h-full items-center"},N={class:"w-3/4 max-w-2xl rounded-lg p-6"},V={class:"flex justify-between items-center mb-4"},R={class:"text-lg font-bold"},S={class:"badge badge-info"},T={class:"space-y-2 max-h-96 w-full overflow-y-auto"},U=["src"],q={class:"grow ml-4 flex flex-col truncate"},G=["title"],H=["title"],J={class:"flex-none btn btn-circle btn-ghost ml-4"},K=["onClick"],O=t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",class:"opacity-25"},null,-1),Q=t("path",{fill:"currentColor",d:"M4 12a8 8 0 017.5-7.98A4 4 0 104 12h4z",class:"opacity-75"},null,-1),W=[O,Q],X=["onClick"],Y=t("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1),Z=[Y],ee=["onClick"],te=t("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"},null,-1),se=[te],oe={key:0,class:"mt-6 text-center"},ae={key:1,class:"mt-6 text-center"},le={key:2,class:"flex justify-center items-center mt-4"},ne=t("div",{class:"loader"},null,-1),ie=[ne],ge={__name:"MulatingImg",setup(re){const{t:u}=P(),b=j(),r=c(""),a=c([]),_=c(!0),d=c(!0),h=c(!0),y=$(()=>a.value.filter(s=>s.status==="processed").length),C=async()=>{for(let s=0;s<a.value.length&&h.value===!0;s++){const o=a.value[s];if(o.base64_image===""){const e=await w("get_local_file_base64",o.image_path);e.code===200&&(o.base64_image=e.data.base64_image)}}},I=async()=>{console.log("start deal image");for(let s=0;s<a.value.length;s++){const o=a.value[s];if(d.value===!0){if(o.status==="waiting"){console.log("deal image",o.image_path,r.value);const e=await k("predict_from_folder_img",{image_path:o.image_path,folder_path:r.value});e.code===200?(o.status="processed",o.no_bg_image=e.data.no_bg_image):(o.status="error",x.error(e.error_msg))}}else return}d.value=!1},f=()=>{d.value=!1},B=async()=>{_.value=!0;const s=await k("get_folder_images",r.value);s.code===200?a.value=s.data.image_list:x.error(s.error_msg),_.value=!1},L=()=>{window.history.back()},m=async s=>{await w("open_and_select_file",s)};return F(async()=>{r.value=b.params.folderPath,console.log(r.value,"foldersPath"),await B(),await Promise.all([C(),I()])}),A(()=>{console.log("unmounted"),f(),h.value=!1,a.value=[]}),(s,o)=>(l(),n("div",E,[t("div",N,[t("div",V,[t("h2",R,i(g(u)("ai_matting.mult_matting.title")),1),t("span",S,i(g(u)("common.processing"))+" "+i(y.value)+" / "+i(a.value.length),1)]),t("ul",T,[(l(!0),n(z,null,D(a.value,(e,M)=>(l(),n("li",{key:M,class:"flex p-2 rounded-lg"},[t("img",{src:e.base64_image,alt:"image",class:"w-16 h-16 rounded flex-none"},null,8,U),t("div",q,[t("p",{class:"truncate",title:e.image_name},i(e.image_name),9,G),t("p",{class:"text-xs text-gray-400 truncate",title:e.image_path},i(e.image_path),9,H)]),t("span",J,[e.status==="waiting"?(l(),n("svg",{key:0,onClick:p=>m(e.image_path),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"w-6 h-6 animate-spin"},W,8,K)):e.status==="processed"?(l(),n("svg",{key:1,onClick:p=>m(e.no_bg_image),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"w-6 h-6 text-green-500"},Z,8,X)):e.status==="error"?(l(),n("svg",{key:2,onClick:p=>m(e.image_path),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",class:"w-6 h-6 text-red-500"},se,8,ee)):v("",!0)])]))),128))]),d.value&&!_.value?(l(),n("div",oe,[t("button",{onClick:o[0]||(o[0]=e=>f()),class:"bg-green-500 text-white px-4 py-2 rounded-full"},i(g(u)("ai_matting.mult_matting.finish")),1)])):(l(),n("div",ae,[t("button",{onClick:o[1]||(o[1]=e=>L()),class:"bg-green-500 text-white px-4 py-2 rounded-full"},i(g(u)("common.btn_back")),1)])),_.value?(l(),n("div",le,ie)):v("",!0)])]))}};export{ge as default};
